<!DOCTYPE html>
<html>
  <head>
    <title>TP H - Slides</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      li {
        clear: left;
        line-height: 2;
      }
      .column {
        color: #777;
        width: 49%;
        height: 92%;
        float: left;
      }
      .column img {
        display: inline;
        max-width: 100%;
      }
      .clear {
        clear: both;
      }
      .pull-left {
        float: left;
      }
      .pull-right {
        float: right;
      }
      .comment { display: none; }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">
class: center, middle

# Javascript
# TP H
# Envoi de données avec AJAX

---

# Javascript - TP H - Objectifs

- Présentation des idées proposées (sondage)
- Présentation des résultats du TP G
- Cours: Envoi de données avec AJAX

---

# Rappels AJAX

- AJAX: requête HTTP controlée par Javascript
- Récupération de données depuis une API en utilisant GET.
- Utilisation de `JSON.parse()` pour transformer `responseText` en objet
- Extraction de données en utilisant notation pointée sur objets
- L'extension [JSONView](https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc) est pratique pour observer les réponses d'API dans Chrome



--
- [Gabarit de support de cours](https://docs.google.com/a/eemi.com/document/d/1Qt_uwv5x0IbhIX_P6vrykVXf_czBpxgS4WzIFrDlubA/edit?usp=sharing)

---

# Envoi de données HTTP POST

- Récupérer des données: HTTP GET -> `responseText`

.pull-left[
  ![diagramme get](./H/diagram-get.svg)
]
.comment[ -- as generated from http://bramp.github.io/js-sequence-diagrams/ --
XMLHttpRequest-->Serveur API: GET /data
Serveur API->XMLHttpRequest: responseText
]

--

.pull-left[
  ![diagramme post](./H/diagram-post.svg)
]
.comment[ -- as generated from http://bramp.github.io/js-sequence-diagrams/ --
XMLHttpRequest->Serveur API: POST /data
Serveur API-->XMLHttpRequest: responseText
]

- Envoyer des données: HTTP POST avec `send(data)`


--

- Demo: [js-ajax-twitter](https://js-ajax-twitter.herokuapp.com/log.html), client: [js-ajax-twitter.herokuapp.com](https://js-ajax-twitter.herokuapp.com/)

---

# Requête HTTP POST par formulaire

- Code source: [index.html](view-source:https://js-ajax-twitter.herokuapp.com/index.html)

```html
<form method="POST" action="/tweet">
  <input name="message">
</form>
```

--
- N'oubliez pas l'attribut `name` pour vos champs !

--
- **Mise en pratique:**
  - *tweetez* depuis un formulaire HTML en local
  - URL de l'API: `https://js-ajax-twitter.herokuapp.com/tweet`
  - Utilisez l'onglet "Réseau" de Chrome Dev Tools pour tester la requête

---

# Requête HTTP POST en AJAX

- Envoi d'une chaine de caractères:

```javascript
var xhr = new XMLHttpRequest();
xhr.open('POST', 'http://httpbin.org/post');
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
    alert(xhr.responseText);
  }
};
xhr.send('données à envoyer');
```

--
- Envoi d'un objet Javascript (JSON):

```javascript
xhr.send(JSON.stringify({ message: 'bonjour!' }));
```

--
- `JSON.stringify()` fait l'opération inverse de `JSON.parse()`
- `JSON.stringify()` transforme un objet JSON en chaine de caractères
- L'API `http://httpbin.org/post` est très pratique pour tester vos requêtes

---

# Exercice: *Tweeter* en AJAX

- **But**: éviter le changement de page pour l'utilisateur quand il *tweete*

- **Comment**: même formulaire HTML, mais en effectuant une requête AJAX



--
- **Étapes proposées**:
  1. Dupliquer le formulaire créé pendant la mise en pratique
  2. Empêcher qu'il soit soumis lorsque l'utilisateur presse <kbd>ENTRÉE</kbd>
  3. Intégrer AJAX, pour que la requête HTTP POST soit émise quand l'utilisateur presse <kbd>ENTRÉE</kbd>
  4. Faire en sorte que le message saisi dans le champ par l'utilisateur soit envoyé

- Pensez à utiliser l'onglet "Réseau" de Chrome Dev Tools pour diagnostiquer.

    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
